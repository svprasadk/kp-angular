<div class="col-sm-12 mar-top-40" *ngIf="productAttributenotAdded">
  <div class="col-sm-12">
    <button class="btn back-btn" (click)="backClicked()">
      <mat-icon class="icon-pos">chevron_left
      </mat-icon>
      <span class="back-class">Back</span>
    </button>
    <span>
      <h4 class="lh-50 dis-in-b mar-l-20" *ngIf="!editHeadingId">Add Attributes</h4>
      <h4 class="lh-50 dis-in-b mar-l-20" *ngIf="editHeadingId">Edit Attributes</h4>
    </span>
  </div>
  <div class="col-sm-12 mar-top-40">
    <h4>Product: {{productDetail.productName}}</h4>
  </div>
  <div class="col-sm-12">
    <form #f="ngForm" novalidate>
      <div class="form-group pro-title">
        <label>Heading*
          <span class="suggestion">(Heading can be at most 60 characters)</span>
        </label>
        <input type="text" class="form-control" [(ngModel)]="heading" name="heading" #head="ngModel" maxlength="60"
          required>
        <p class="error" *ngIf="!head.valid && head.touched || !head.valid && submitted">Heading is required</p>
      </div>
      <!-- <div class="col-sm-11">
        <mat-accordion>
          <mat-expansion-panel *ngFor="let subhead of subHeadingArray; let r = index;" class="custom-header" hideToggle="true" #example>
            <mat-expansion-panel-header>
              <mat-panel-title>
                {{subhead.subHeading}}
              </mat-panel-title>
              <mat-panel-description class="text-right">
                <i class="material-icons blue right-50" (click)="Editsubhead($event, subhead, r)">
                  create
                </i>
                <i class="material-icons red right-70" (click)="deletesubhead($event, subhead,r)">
                  delete
                </i>
                <mat-icon class="right-20" *ngIf="!example.expanded">add</mat-icon>
                <mat-icon class="right-20" *ngIf="example.expanded">remove</mat-icon>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <div class="col-sm-12" *ngIf="subhead.contentFormat=='image'">
              <div class="col-md-5 margin-5" *ngFor="let image of subhead.images">
                <img src="{{image}}" width="60%" style="margin:0 auto;">
              </div>
            </div>
            <div class="col-sm-12" *ngIf="subhead.contentFormat=='pdf'">
              <div class="col-sm-12" *ngFor="let pdf of subhead.pdfs">

                <embed [src]="sanitizer.bypassSecurityTrustResourceUrl(pdf)" type="application/pdf" width="800px" height="400px">
              </div>
            </div>
            <div class="col-sm-12" *ngIf="subhead.contentFormat=='text'">
              <div [innerHTML]="subhead.text"></div>
            </div>

            <div class="col-sm-12" *ngIf="subhead.contentFormat=='videofile'">
              <div class="col-md-5 margin-5" *ngFor="let vid of subhead.videourls">
                <video width="320" height="240" controls>
                  <source src="{{vid}}"> Your browser does not support the video tag.
                </video>
              </div>
            </div>
            <div class="col-sm-12" *ngIf="subhead.contentFormat=='videoUrl'">
              <div class="col-md-5 margin-5" *ngFor="let vid of subhead.videoURl">
                <iframe width="320" height="240" [src]="getYouTubeUrlSanatize(vid)" frameborder="0" allowfullscreen>
                </iframe>
              </div>
            </div>

          </mat-expansion-panel>

        </mat-accordion>
      </div> -->
      <!-- <div class="col-sm-12 mar-top-20">
        <div class="col-sm-7">
          <div class="form-group pro-title">
            <label>Sub Heading *</label>
            <input type="text" class="form-control" [(ngModel)]="subHeading" name="subheading" #subhead="ngModel" required>
            <p class="error" *ngIf="!subhead.valid && subhead.touched || !subhead.valid && submitted">Sub Heading is required</p>

          </div>
        </div>
        <div class="col-sm-5 pad-top-50">
          <mat-checkbox class="example-margin" [(ngModel)]="isLocationChecked" name="check" disableRipple>
            <h4 class="mar-0 text-color-grey pos-rel lh-30">Location
              <span class="bottomtip">If location based select city and zone</span>
            </h4>

          </mat-checkbox>
        </div>
      </div> -->
      <div class="col-sm-11" *ngIf="subHeadingArray.length">
        <mat-tree [dataSource]="nestedDataSourceView" [treeControl]="nestedTreeControlView" class="example-tree"
          #treeSelector>
          <mat-nested-tree-node *matTreeNodeDef="let node1; let r = dataIndex; when: hasNestedChildView">
            <li>
              <div class="mat-tree-node">
                node1 -- {{node1 | json}}
                <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node1.filename">
                  <mat-icon class="mat-icon-rtl-mirror" *ngIf="node1.children.length>0">
                    {{nestedTreeControlView.isExpanded(node1) ? 'expand_more' : 'chevron_right'}}
                  </mat-icon>
                </button> {{node1.filename}}
                <div class="col-sm-12" *ngIf="node1.contentFormat=='image'">
                  <div class="col-md-5 margin-5" *ngFor="let image of imageContent">
                    <div *ngIf="image.id == node1.id">
                      <img src="{{image.value}}" width="60%" style="margin:0 auto;">
                    </div>
                  </div>
                </div>
                <div class="col-sm-12" *ngIf="node1.contentFormat=='pdf'">
                  <div class="col-sm-12" *ngFor="let pdf of pdfContent">
                    <div *ngIf="pdf.id == node1.id">
                      <embed [src]="sanitizer.bypassSecurityTrustResourceUrl(pdf.value)" type="application/pdf"
                        width="800px" height="400px">
                    </div>
                  </div>
                </div>
                <div class="col-sm-12" *ngIf="node1.contentFormat=='text'">
                  <div [innerHTML]="node1.text"></div>
                </div>

                <div class="col-sm-12" *ngIf="node1.contentFormat=='videofile'">
                  <div class="col-md-5 margin-5" *ngFor="let vid of videoFileContent">
                    <div *ngIf="vid.id == node1.id">
                      <video width="320" height="240" controls>
                        <source src="{{vid.value}}"> Your browser does not support the video tag.
                      </video>
                    </div>
                  </div>
                </div>
                <div class="col-sm-12" *ngIf="node1.contentFormat=='videoUrl'">
                  <div class="col-md-5 margin-5" *ngFor="let vid of node1.videoURl">
                    <div *ngIf="vid.id == node1.id">
                      <iframe width="320" height="240" [src]="getYouTubeUrlSanatize(vid.value)" frameborder="0"
                        allowfullscreen>
                      </iframe>
                    </div>
                  </div>
                </div>
              </div>
              <ul [class.example-tree-invisible]="!nestedTreeControlView.isExpanded(node1)">
                <ng-container matTreeNodeOutlet></ng-container>
              </ul>
            </li>
            <button mat-icon-button
              (click)="Editsubhead($event, node1, nestedDataSourceView._data._value.indexOf(node1), newNodeIdEdit, currentNodeEdit)"
              *ngIf="node1.level==0 ">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button
              (click)="deletesubhead($event, node1, nestedDataSourceView._data._value.indexOf(node1), newNodeIdEdit, currentNodeEdit)"
              *ngIf="node1.level==0 ">
              <mat-icon>delete</mat-icon>
            </button>
          </mat-nested-tree-node>
        </mat-tree>
      </div>
      <div class="col-sm-12">&nbsp;</div>
      <div class="col-sm-12">
        <mat-tree [dataSource]="nestedDataSource" [treeControl]="nestedTreeControl" class="example-tree" #treeSelector>
          <mat-nested-tree-node *matTreeNodeDef="let node; when: hasNestedChild;">
            <li>
              <div class="mat-tree-node">
                <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.filename">
                  <mat-icon class="mat-icon-rtl-mirror" *ngIf="node.children.length>0">
                    {{nestedTreeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                  </mat-icon>
                </button> <span style="padding-right: 5px;">Sub Heading {{node.id}}</span> <input type="text"
                  [(ngModel)]="node.filename" name="node{{node.filename}}" class="form-control" #sh="ngModel"
                  required />
                <button mat-icon-button (click)="addNewItem(node)" [disabled]="contenttype[node.id]">
                  <mat-icon>add</mat-icon>
                </button>
                <button *ngIf="node.children.length ==0 && node.level!=0 " mat-icon-button (click)="remove(node)"
                  [disabled]="contenttype[node.id]">
                  <mat-icon>close</mat-icon>
                </button>
                <div class="col-sm-12 mar-top-20" *ngIf="node.children.length ==0 && node.level!=0 ">
                  <div class="col-sm-12 ">
                    <h4 class="label-title">Select Content Format*</h4>

                    <mat-radio-group class="example-radio-group" [(ngModel)]="contenttype[node.id]"
                      name="contenttype{{node.id}}" (change)="contentTypeChange(node, node.id, attributeSaveType)" required>
                      <mat-radio-button class="example-radio-button" value="text" disableRipple>
                        Text
                      </mat-radio-button>
                      <mat-radio-button class="example-radio-button" value="pdf" disableRipple>
                        PDF
                      </mat-radio-button>
                      <mat-radio-button class="example-radio-button" value="image" disableRipple>
                        Image
                      </mat-radio-button>
                      <mat-radio-button class="example-radio-button" value="videofile" disableRipple>
                        Video File
                      </mat-radio-button>
                      <mat-radio-button class="example-radio-button" value="videoUrl" disableRipple>
                        Video Url
                      </mat-radio-button>

                    </mat-radio-group>
                    <p class="error zone-error" *ngIf="!contenttype[node.id] && submitted">Select content type</p>

                  </div>
                  <div class="col-sm-12 mar-top-20" *ngIf="contenttype[node.id]==='text'">
                    <quill-editor [(ngModel)]="subheadDescription[node.id]" name="description{{node.id}}"
                      [style]="{'height': '200px'}">
                      <div quill-editor-toolbar>
                        <span class="ql-formats">
                          <select class="ql-font">
                            <option selected></option>
                            <option value="serif"></option>
                            <option value="monospace"></option>
                          </select>
                          <select class="ql-size">
                            <option value="small"></option>
                            <option selected></option>
                            <option value="large"></option>
                            <option value="huge"></option>
                          </select>
                        </span>
                        <span class="ql-formats">
                          <button class="ql-bold"></button>
                          <button class="ql-italic"></button>
                          <button class="ql-underline"></button>
                          <button class="ql-strike"></button>
                        </span>
                        <span class="ql-formats">
                          <select class="ql-color"></select>
                          <select class="ql-background"></select>
                        </span>
                        <span class="ql-formats">
                          <button class="ql-list" value="ordered"></button>
                          <button class="ql-list" value="bullet"></button>
                          <select class="ql-align">
                            <option selected></option>
                            <option value="center"></option>
                            <option value="right"></option>
                            <option value="justify"></option>
                          </select>
                        </span>
                        <span class="ql-formats">
                          <button class="ql-link"></button>
                        </span>
                      </div>
                    </quill-editor>
                  </div>

                  <div class="col-sm-12 mar-top-20" *ngIf="contenttype[node.id]==='pdf'">
                    <!-- <label for="filePdf" class="fileBrowseBtn">
                      Browse
                    </label> -->
                    <input type="file" accept="application/pdf" (change)="pdfFileChange($event, node.id)"
                      [(ngModel)]="filePdf[node.id]" name="filePdf{{node.id}}" class="fileBrowseBtn" multiple />
                    <span class="text-color-grey" *ngIf="pdfData.length">
                      {{countFilesUploaded(node.id, pdfData)}}
                      File{{countFilesUploaded(node.id, pdfData)>1?'s':''}}
                      Attached</span>
                    <div *ngFor="let file of pdfData; let m=index;">
                      <div *ngIf="file.id == node.id" class="pdfBlock">
                        <mat-icon class="pos-abs-icon" (click)="deletepdf(m)">cancel</mat-icon>
                        <a>
                          <img src="assets/PDF_icon.svg">
                        </a>
                      </div>
                    </div>
                  </div>

                  <div class="col-sm-12 mar-top-20" *ngIf="contenttype[node.id]==='image'">
                    <!-- <label for="fileimg" class="fileBrowseBtn">
                      Browse
                    </label> -->
                    <input type="file" accept="image/*" (change)="imgFileChange($event, node.id)" class="fileBrowseBtn"
                      multiple />
                    <span class="text-color-grey" *ngIf="urls.length">
                      {{countFilesUploaded(node.id, urls)}}
                      File{{countFilesUploaded(node.id, urls)>1?'s':''}}
                      Attached</span>
                    <div *ngFor="let url of urls;let k=index;">
                      <div *ngIf="url.id == node.id" class="imgBlock">
                        <mat-icon class="pos-abs-icon" (click)="deleteImg(k)">cancel</mat-icon>
                        <a>
                          <img src="{{url.value}}">
                        </a>
                      </div>
                    </div>
                  </div>

                  <div class="col-sm-12 mar-top-20" *ngIf="contenttype[node.id]==='videofile'">
                    <!-- <label for="filevid" class="fileBrowseBtn">
                      Browse
                    </label> -->
                    <mat-spinner *ngIf="loadingvideo"></mat-spinner>
                    <input type="file" accept="video/*" (change)="vidFileChange($event, node.id)" multiple />
                    <span class="text-color-grey" *ngIf="videoUrls.length">
                      {{countFilesUploaded(node.id, videoUrls)}}
                      File{{countFilesUploaded(node.id, videoUrls)>1?'s':''}}
                      Attached</span>
                    <div *ngFor="let videourl of videoUrls; let l=index;">
                      <div *ngIf="videourl.id == node.id" class="vidBlock">
                        <mat-icon class="pos-abs-icon" (click)="deletevideo(l)">cancel</mat-icon>
                        <video width="80" height="80" controls class="videoblock">
                          <source src="{{videourl.value}}">
                        </video>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-12 mar-top-20" *ngIf="contenttype[node.id]==='videoUrl'">
                    <div class="form-group form-inline pro-title">
                      <label>Video Url</label>
                      <input type="text" class="form-control videourl-input" pattern="{{videoReg}}"
                        [(ngModel)]="videoUrl[node.id]" name="videoUrl{{node.id}}" #videour="ngModel">
                      <span (click)="addVideoUrls(videour, node.id)" [ngClass]="{'disableclick':!videour.valid}">
                        <mat-icon class="icon-add">add_circle</mat-icon>
                      </span>
                      <p class="error" *ngIf="videour.touched && !videour.valid">Wrong url</p>
                    </div>
                    <div *ngFor="let url of videoUrlsUrl; let p=index;">
                      <div *ngIf="url.id == node.id">
                        <a href="https://www.youtube.com/watch/{{url[value]}}" target="_blank">Video</a>
                        <mat-icon class="n" (click)="deleteurl(p)">cancel</mat-icon>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-sm-12 mar-top-20" *ngIf="node.children.length ==0 && node.level==0 ">
                  <div class="col-sm-12 ">
                    <h4 class="label-title">Select Content Format*</h4>
                    <mat-radio-group class="example-radio-group" [(ngModel)]="contenttype[node.id]"
                      name="contenttype{{node.id}}" (change)="contentTypeChange(node, node.id, attributeSaveType)" required>
                      <mat-radio-button class="example-radio-button" value="text" disableRipple>
                        Text
                      </mat-radio-button>
                      <mat-radio-button class="example-radio-button" value="pdf" disableRipple>
                        PDF
                      </mat-radio-button>
                      <mat-radio-button class="example-radio-button" value="image" disableRipple>
                        Image
                      </mat-radio-button>
                      <mat-radio-button class="example-radio-button" value="videofile" disableRipple>
                        Video File
                      </mat-radio-button>
                      <mat-radio-button class="example-radio-button" value="videoUrl" disableRipple>
                        Video Url
                      </mat-radio-button>

                    </mat-radio-group>
                    <p class="error zone-error" *ngIf="!contenttype[node.id] && submitted">Select content type</p>

                  </div>
                  <div class="col-sm-12 mar-top-20" *ngIf="contenttype[node.id]==='text'">
                    <quill-editor [(ngModel)]="subheadDescription[node.id]" name="description{{node.id}}"
                      [style]="{'height': '200px'}">
                      <div quill-editor-toolbar>
                        <span class="ql-formats">
                          <select class="ql-font">
                            <option selected></option>
                            <option value="serif"></option>
                            <option value="monospace"></option>
                          </select>
                          <select class="ql-size">
                            <option value="small"></option>
                            <option selected></option>
                            <option value="large"></option>
                            <option value="huge"></option>
                          </select>
                        </span>
                        <span class="ql-formats">
                          <button class="ql-bold"></button>
                          <button class="ql-italic"></button>
                          <button class="ql-underline"></button>
                          <button class="ql-strike"></button>
                        </span>
                        <span class="ql-formats">
                          <select class="ql-color"></select>
                          <select class="ql-background"></select>
                        </span>
                        <span class="ql-formats">
                          <button class="ql-list" value="ordered"></button>
                          <button class="ql-list" value="bullet"></button>
                          <select class="ql-align">
                            <option selected></option>
                            <option value="center"></option>
                            <option value="right"></option>
                            <option value="justify"></option>
                          </select>
                        </span>
                        <span class="ql-formats">
                          <button class="ql-link"></button>
                        </span>
                      </div>
                    </quill-editor>
                  </div>

                  <div class="col-sm-12 mar-top-20" *ngIf="contenttype[node.id]==='pdf'">
                    <!-- <label for="filePdf" class="fileBrowseBtn">
                      Browse
                    </label> -->
                    <input type="file" id="filePdf{{node.id}}" accept="application/pdf"
                      (change)="pdfFileChange($event, node.id)" [(ngModel)]="filePdf[node.id]" name="filePdf{{node.id}}"
                      class="fileBrowseBtn" multiple />
                    <span class="text-color-grey" *ngIf="pdfData.length">
                      {{countFilesUploaded(node.id, pdfData)}}
                      File{{countFilesUploaded(node.id, pdfData)>1?'s':''}}
                      Attached</span>
                    <div *ngFor="let file of pdfData; let m=index;">
                      <div *ngIf="file.id == node.id" class="pdfBlock">
                        <mat-icon class="pos-abs-icon" (click)="deletepdf(m)">cancel</mat-icon>
                        <a>
                          <img src="assets/PDF_icon.svg">
                        </a>
                      </div>
                    </div>                    
                  </div>

                  <div class="col-sm-12 mar-top-20" *ngIf="contenttype[node.id]==='image'">
                    <!-- <label for="fileimg" class="fileBrowseBtn">
                      Browse
                    </label> -->
                    <input type="file" id="fileimg{{node.id}}" accept="image/*"
                      (change)="imgFileChange($event, node.id)" class="fileBrowseBtn" multiple />
                    <span class="text-color-grey" *ngIf="urls.length">
                      {{countFilesUploaded(node.id, urls)}}
                      File{{countFilesUploaded(node.id, urls)>1?'s':''}}
                      Attached</span>
                    <div *ngFor="let url of urls;let k=index;">
                      <div *ngIf="url.id == node.id" class="imgBlock">
                        <mat-icon class="pos-abs-icon" (click)="deleteImg(k)">cancel</mat-icon>
                        <a>
                          <img src="{{url.value}}">
                        </a>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-12 mar-top-20" *ngIf="contenttype[node.id]==='videofile'">
                    <!-- <label for="filevid" class="fileBrowseBtn">
                      Browse
                    </label> -->
                    <mat-spinner *ngIf="loadingvideo"></mat-spinner>
                    <input type="file" id="filevid{{node.id}}" accept="video/*"
                      (change)="vidFileChange($event, node.id)" class="fileBrowseBtn" multiple />
                    <span class="text-color-grey" *ngIf="videoUrls.length">
                      {{countFilesUploaded(node.id, videoUrls)}}
                      File{{countFilesUploaded(node.id, videoUrls)>1?'s':''}}
                      Attached</span>
                    <div *ngFor="let videourl of videoUrls; let l=index;">
                      <div *ngIf="videourl.id == node.id" class="vidBlock">
                        <mat-icon class="pos-abs-icon" (click)="deletevideo(l)">cancel</mat-icon>
                        <video width="80" height="80" controls class="videoblock">
                          <source src="{{videourl.value}}">
                        </video>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-12 mar-top-20" *ngIf="contenttype[node.id]==='videoUrl'">
                    <div class="form-group form-inline pro-title">
                      <label>Video Url</label>
                      <input type="text" class="form-control videourl-input" pattern="{{videoReg}}"
                        [(ngModel)]="videoUrl[node.id]" name="videoUrl{{node.id}}" #videour="ngModel">
                      <span (click)="addVideoUrls(videour, node.id)" [ngClass]="{'disableclick':!videour.valid}">
                        <mat-icon class="icon-add">add_circle</mat-icon>
                      </span>
                      <p class="error" *ngIf="videour.touched && !videour.valid">Wrong url</p>
                    </div>
                    <div *ngFor="let url of videoUrlsUrl; let p=index;">
                      <div *ngIf="url.id == node.id">
                        <a href="https://www.youtube.com/watch/{{url.value}}" target="_blank">Video</a>
                        <mat-icon class="n" (click)="deleteurl(p)">cancel</mat-icon>
                      </div>
                    </div>                    
                  </div>
                </div>
              </div>
              <p class="error" *ngIf="!sh.valid && sh.touched || !sh.valid && submitted">Sub Heading is required</p>
              <ul [class.example-tree-invisible]="!nestedTreeControl.isExpanded(node)">
                <ng-container matTreeNodeOutlet></ng-container>
              </ul>
            </li>
          </mat-nested-tree-node>
        </mat-tree>
      </div>
      <div class="col-sm-12 text-right mar-top-20px" *ngIf="!editHeadingId">
        <button class="btn border-btn" (click)="saveAndAddNew()"
          [disabled]="!f.valid ||(isLocationChecked && !cityCtrl.value)">Save & Add new</button>
        <button class="btn cancel-btn" (click)="cancelAttributeadding()">CANCEL</button>
        <!-- Author:Sateesh, Date:14/03/2019
        Create button for add publish now or later -->
        <button type="submit" *ngIf="isPublished" class="btn submit-btn" (click)="saveAndAddNew(true)"
          [disabled]="!heading || (!subHeadingArray.length && !f.valid) ||(isLocationChecked && !cityCtrl.value)">ADD</button>
        <button type="submit" *ngIf="!isPublished" class="btn submit-btn widthauto" (click)="saveAndAddNew(true)"
          [disabled]="!heading || (!subHeadingArray.length && !f.valid) ||(isLocationChecked && !cityCtrl.value)">Add &
          Publish Later</button>
        <button type="submit" *ngIf="!isPublished" class="btn submit-btn widthauto"
          (click)="doPublish=true; saveAndAddNew(true)"
          [disabled]="!heading || (!subHeadingArray.length && !f.valid) ||(isLocationChecked && !cityCtrl.value)">Add &
          Publish Now</button>
      </div>
      <div class="col-sm-12 text-right mar-top-20px" *ngIf="editHeadingId">
        <!-- <button class="btn border-btn" (click)="saveAndAddNew()" [disabled]="!f.valid">Save & Add new</button>-->
        <button class="btn cancel-btn" routerLink="/admin/products/details/{{productId}}">CANCEL</button>
        <button type="submit" class="btn submit-btn" (click)="saveAndAddNew(true)"
          [disabled]="!heading ">UPDATE</button>
      </div>
    </form>
  </div>
</div>
<div class="col-sm-12 Aligner ht-95" *ngIf="!productAttributenotAdded">
  <div class="Aligner-item">
    <h3 class="clr-green">Product Attributes has been successfully Added</h3>
    <div class="col-sm-12">
      <button class="btn action-btn vpl" routerLink="/admin/products">View Product List</button>
      <button class="btn action-btn liteblue-btn vpl" (click)="productAttributenotAdded = true;">Add More
        Attributes</button>
      <!-- <button class="btn action-btn liteblue-btn vpl">Add Attributes</button> -->
    </div>
  </div>
</div>